/*! bms-kyipad 2014-10-31 4:08:17 PM */

seajs.config({base:"http://js.wanmeiyueyu.com/bms-kyipad/js/",alias:{}}),define("app",[],function(){return angular.module("bmsIPad",["ngRoute"])}),define("article/article-create/controller",["app","public/local/service","./service","public/local/http","public/general/pub-sub","public/general/directive/editor","public/general/directive/date-picker","public/general/directive/view-img","public/general/directive/drag-sort","public/general/directive/submitting","public/general/form-validation"],function(a){var b=a("app");a("public/local/service"),a("./service"),a("public/general/directive/editor"),a("public/general/directive/date-picker"),a("public/general/directive/view-img"),a("public/general/directive/drag-sort"),a("public/general/directive/submitting");var c=a("public/general/form-validation");b.controller("articleCreateCtrl",["$scope","$routeParams","publicService","articleCreateService",function(a,b,d,e){function f(){a.addedApp=[],a.submitted=!1,a.article={imgUrl:""},a.articleForm={id:"",release_time:"",title:"",type:"testing",content:"article",source:"",up_file:"",first_pic:"",text:"",priority_etime:"",priority_stime:"",applications:""},a.formReset=!0,a.imgClear=!0,a.article={set firstPicFiles(b){a.$apply(function(){a.articleForm.up_file=b[0]})},isTop:0}}f(),"null"!=b.id&&e.getArticleDetail(b.id,function(b){a.articleForm.id=b.id,a.articleForm.content=b.content,a.articleForm.release_time=b.release_time,a.articleForm.source=b.source,a.articleForm.text=b.text,a.articleForm.title=b.title,a.articleForm.type=b.type,a.articleForm.priority_etime=b.priority_etime,a.articleForm.priority_stime=b.priority_stime,a.article.isTop=d.isTop(b)?1:0,a.articleForm.first_pic=a.article.imgUrl=b.up_file,b.applications.forEach(function(b){a.addApp(b)})}),a.addArticle=function(b){a.submitted=!0,c.setFormValidataion(b),b.$valid&&a.addedApp.length>-1&&!a.submitting&&(a.submitting=!0,0==a.article.isTop&&(a.articleForm.priority_stime=a.articleForm.priority_etime=""),a.articleForm.id&&a.articleForm.up_file&&(a.articleForm.first_pic=""),a.articleForm.applications=JSON.stringify(d.getApplications(a.addedApp)),e.addArticle(a.articleForm,function(){f(),a.submitting=!1},function(){a.submitting=!1}))},a.sortAddedApp=function(b){a.addedApp=d.sortAddedApp(b,a.addedApp)},a.deleteApp=function(b){a.addedApp=a.addedApp.filter(function(a){return a.APPID!==b.APPID})},a.addApp=function(b){var c=a.addedApp.length;return d.isAdded(b,a.addedApp)?{success:!1,msg:"此app已经添加过"}:(a.addedApp.push(b),a.$broadcast("addedAppChanging",b),d.getAppDetail(d.getAppId(b),"article",function(b){a.addedApp[c]=b,a.$broadcast("addedAppChanged",b)}),{success:!0,msg:""})},a.getAddedApp=function(){return a.addedApp}}])}),define("article/article-create/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("articleCreateService",["httpService",function(a){return{addArticle:function(b,d,e){a.post({r:"article/create",data:b,success:function(a){d&&d(a),c.publish("businessSuccess",{title:"编辑文章app成功!",msg:""})},error:e})},getArticleDetail:function(b,c,d){var e={id:b};a.get({r:"article/edit",data:e,success:function(a){a.applications=JSON.parse(a.applications),c(a)},error:d})}}}])}),define("article/article-list/controller",["app","public/general/date-util","public/local/service","./service","public/local/http","public/general/pub-sub","public/general/directive/tooltip"],function(a){{var b=a("app");a("public/general/date-util")}a("public/local/service"),a("./service"),a("public/general/directive/tooltip"),b.controller("articleListCtrl",["$scope","$routeParams","publicService","articleListService",function(a,b,c,d){a.searchForm={title:""},a.searchResult={articleList:[]},a.searchStatus=a.SEARCH_STATUS.INIT,a.$on("searchStart",function(){a.searchStatus=a.SEARCH_STATUS.SEARCHING}),a.$on("searchEnd",function(b,d){a.searchStatus=a.SEARCH_STATUS.SEARCH_SUCCESSED,a.searchResult.articleList=d.data,a.searchResult.articleList.forEach(function(a){a.isTop=c.isTop(a)})}),a.$on("searchFail",function(){a.searchStatus=a.SEARCH_STATUS.SEARCH_FAILED}),a.search=function(){a.paginationScope.goPage(1)},a.deleteArticle=function(b){d.deleteArticle(b,function(){a.paginationScope.goPage()})},a.cancelTop=function(b){d.cancelTop(b,function(){a.paginationScope.goPage()})},a.toTopArticle=function(b,c){c.submitted=!0;var e;b&&(e=c.article,d.toTopArticle(e.id,e.priority_stime,e.priority_etime,function(){c.deletePopover=!0,a.paginationScope.goPage()}))},a.$watch("paginationScope",function(){a.paginationScope&&(a.paginationScope.searchForm=a.searchForm,a.paginationScope.searchInterface="article/index",a.paginationScope.goPage(1))})}])}),define("article/article-list/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("articleListService",["httpService",function(a){return{deleteArticle:function(b,d,e){var f={id:b};a.get({r:"article/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"删除文章成功!",msg:""}),d(a)},error:e})},toTopArticle:function(b,d,e,f,g){var h={id:b,priority_stime:d,priority_etime:e};a.get({r:"article/setPriority",data:h,success:function(a){c.publish("businessSuccess",{title:"置顶成功!",msg:""}),f(a)},error:g})},cancelTop:function(b,d,e){a.get({r:"article/setPriority",data:{id:b,priority_stime:"",priority_etime:""},success:function(a){c.publish("businessSuccess",{title:"取消置顶成功!",msg:""}),d(a)},error:e})}}}])}),define("boutique/article-add/controller",["app","public/local/service","./service","public/local/http","public/general/pub-sub","public/general/directive/date-picker","public/general/directive/view-img","public/general/directive/submitting"],function(a){var b=a("app");a("public/local/service"),a("./service"),a("public/general/directive/date-picker"),a("public/general/directive/view-img"),a("public/general/directive/submitting"),b.controller("articleAddCtrl",["$scope","$routeParams","publicService","articleAddService",function(a,b,c,d){function e(){a.addedArticle=[],a.submitted=!1,a.articleForm={id:"",release_time:"",articles:""}}e(),"null"!=b.id&&d.getArticlePlan(b.id,function(b){a.articleForm.id=b.id,a.articleForm.release_time=b.release_time,d.getArticleDetail(b.article_id,function(b){a.addedArticle=b.data})}),a.submitArticle=function(b){a.submitted=!0,b&&a.addedArticle.length>0&&!a.submitting&&a.confirmSubmit()},a.confirmSubmit=function(){a.submitting=!0,a.articleForm.articles=JSON.stringify(c.getArticles(a.addedArticle)),d.addArticle(a.articleForm,function(){a.submitting=!1,e()},function(){a.submitting=!1})},a.deleteArticle=function(b){a.addedArticle=a.addedArticle.filter(function(a){return a.id!==b.id}),a.$broadcast("addedArticleChanged")},a.sortAddedArticle=function(b){a.addedArticle=c.sortAddedArticle(b,a.addedArticle)},a.addArticle=function(b){return c.contains(b,a.addedArticle)||a.addedArticle.push(b),a.$broadcast("addedArticleChanged"),{success:!0,msg:""}},a.getAddedArticle=function(){return a.addedArticle}}])}),define("boutique/article-add/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("articleAddService",["httpService",function(a){return{addArticle:function(b,d,e){a.post({r:"boutiqueArticle/create",data:b,success:function(a){d&&d(a),c.publish("businessSuccess",{title:"编辑文章app成功!",msg:""})},error:e})},getArticlePlan:function(b,c,d){var e={id:b,type:"article"};a.get({r:"boutique/edit",data:e,success:function(a){"applications"in a&&(a.applications=JSON.parse(a.applications)),c(a)},error:d})},getArticleDetail:function(b,c,d){a.get({r:"article/index",data:{id:b},success:function(a){c(a)},error:d})}}}])}),define("boutique/boutique-list/controller",["app","public/local/system","public/general/directive/date-picker","./service","public/local/http","public/general/pub-sub","public/general/directive/prevent-spread","public/general/directive/confirm-hint","public/general/directive/tooltip","public/general/directive/drag-sort"],function(a){var b=a("app"),c=a("public/local/system");a("public/general/directive/date-picker"),a("./service"),a("public/general/directive/prevent-spread"),a("public/general/directive/confirm-hint"),a("public/general/directive/tooltip"),a("public/general/directive/drag-sort");var d=a("public/general/pub-sub");b.controller("boutiqueListCtrl",["$scope","$filter","boutiqueListService",function(a,b,e){function f(b){a.searchStatus!==a.SEARCH_STATUS.SEARCHING&&(a.searchStatus=a.SEARCH_STATUS.SEARCHING,e.getBoutiqueList(b,function(b){a.searchStatus=a.SEARCH_STATUS.SEARCH_SUCCESSED,a.boutiqueList=b.boutiqueList,i(b.boutiqueList),a.submitted=!1},function(){a.searchStatus=a.SEARCH_STATUS.SEARCH_FAILED}))}function g(a){e.getMore(a,function(a){h(a.boutiqueList[0])})}function h(b){var c=a.boutiqueList.some(function(c,d){return b.time==c.time?(a.boutiqueList[d].article=b.article,a.boutiqueList[d].iconapp=b.iconapp,a.boutiqueList[d].picapp=b.picapp,a.boutiqueList[d].turnpic=b.turnpic,!0):!1});c||a.boutiqueList.push(b)}function i(c){a.nextTime=j(b("orderBy")(c,"time",!1)[0].time)}function j(a){var b=new Date(a);return b.setDate(b.getDate()-1),b.toJSON().substring(0,10)}var k=10;a.submitted=!1,a.introduceTemplateUrl=c.getTplAbsolutePath("tpl/public/app-introduce-edit.html"),a.searchStatus=a.SEARCH_STATUS.INIT,f(null),a.search=function(b){a.submitted=!0,b&&f(a.time)},a.updateIntroduce=function(a,b){var c=b.app;b.introduceSubmitted=!0,a&&e.updateIntroduce({id:c.j_id,text:c.tempIntroduce},function(){c.APPINTRO=c.tempIntroduce,b.deletePopover=!0,b.introduceSubmitted=!1})},a.getMore=function(){a.boutiqueList.length>=k?d.publish("businessError",{title:"最多展示十天数据!",msg:""}):(e.getMore(a.nextTime,function(b){a.boutiqueList=a.boutiqueList||[],a.boutiqueList.push(b.boutiqueList[0])}),a.nextTime=j(a.nextTime))},a.sortSlide=function(a,b){e.sortSlide(a,function(){g(b)},function(){g(b)})},a.sortPicture=function(a,b){e.sortPicture(a,function(){g(b)},function(){g(b)})},a.sortArticle=function(a,b){e.sortArticle(a,function(){g(b)},function(){g(b)})},a.sortIcon=function(a,b){e.sortIcon(a,function(){g(b)},function(){g(b)})},a.deleteSlide=function(a,b){e.deleteSlide(a,function(){g(b)})},a.deletePicture=function(a,b){e.deletePicture(a,function(){g(b)})},a.deleteIcon=function(a,b){e.deleteIcon(a,function(){g(b)})},a.deleteArticle=function(a,b){e.deleteArticle(a,function(){g(b)})}}])}),define("boutique/boutique-list/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("boutiqueListService",["$filter","httpService",function(a,b){function d(b,c){var d=[],e=new Date(c.date);return e.setHours(23),e.setMinutes(59),e.setSeconds(59),angular.forEach(b,function(a){if(angular.isObject(a)){var b=new Date(a.time);a.status=b>e?"等待":"已发布",d.push(a)}}),{time:d.length>0?a("orderBy")(d,"time",!0)[0].time:"",boutiqueList:a("orderBy")(d,"time",!0)}}return{getMore:function(a,c,e){var f={time:a};b.get({r:"boutique/getMore",data:f,success:function(a,b){c(d(a,b))},error:e})},getBoutiqueList:function(a,c,e){var f={time:a};b.get({r:"boutique/index",data:f,success:function(a,b){c(d(a,b))},error:e})},updateIntroduce:function(a,d,e){b.get({r:"boutique/editSummary",data:a,success:function(a){c.publish("businessSuccess",{title:"简介编辑成功!",msg:""}),d&&d(a)},error:e})},sortSlide:function(a,d,e){b.get({r:"boutique/updateAppSort",data:{data:JSON.stringify(a),type:"turnpic"},success:function(a){c.publish("businessSuccess",{title:"轮播图排序成功!",msg:""}),d&&d(a)},error:e})},sortIcon:function(a,d,e){b.get({r:"boutique/updateAppSort",data:{data:JSON.stringify(a),type:"iconapp"},success:function(a){c.publish("businessSuccess",{title:"iconapp排序成功!",msg:""}),d&&d(a)},error:e})},sortPicture:function(a,d,e){b.get({r:"boutique/updateAppSort",data:{data:JSON.stringify(a),type:"picapp"},success:function(a){c.publish("businessSuccess",{title:"图形app排序成功!",msg:""}),d&&d(a)},error:e})},sortArticle:function(a,d,e){b.get({r:"boutique/updateAppSort",data:{data:JSON.stringify(a),type:"article"},success:function(a){c.publish("businessSuccess",{title:"文章排序成功!",msg:""}),d&&d(a)},error:e})},deleteSlide:function(a,d,e){var f={id:a,type:"turnpic"};b.get({r:"boutique/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"轮播图删除成功!",msg:""}),d(a)},error:e})},deleteArticle:function(a,d,e){var f={id:a,type:"article"};b.get({r:"boutique/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"文章删除成功!",msg:""}),d(a)},error:e})},deleteIcon:function(a,d,e){var f={id:a,type:"iconapp"};b.get({r:"boutique/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"icon删除成功!",msg:""}),d(a)},error:e})},deletePicture:function(a,d,e){var f={id:a,type:"picapp"};b.get({r:"boutique/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"图形app删除成功!",msg:""}),d(a)},error:e})}}}])}),define("boutique/icon-add/controller",["app","public/general/pub-sub","public/local/service","./service","public/local/http","public/general/directive/drag-sort","public/general/directive/submitting"],function(a){{var b=a("app");a("public/general/pub-sub")}a("public/local/service"),a("./service"),a("public/general/directive/drag-sort"),a("public/general/directive/submitting"),b.controller("iconAddCtrl",["$scope","$routeParams","publicService","iconAddService",function(a,b,c,d){function e(){a.iconForm={id:"",release_time:"",applications:""},a.submitted=!1,a.addedApp=[]}a.needAppCount=7,a.repeatedApp=[],a.showRepeatedHint=!1,e(),"null"!=b.id&&d.getIconDetail(b.id,function(c){a.iconForm.id=b.id,a.iconForm.release_time=c.release_time,c.applications.forEach(function(b){a.addApp(b)})}),a.addIcon=function(b){a.submitted=!0,b&&a.addedApp.length>=1&&!a.submitting&&(a.repeatedApp=c.getRepeatedApp(a.addedApp,a.iconForm.release_time,"IpadBoutiqueIconApp"),0===a.repeatedApp.length?a.confirmSubmit():a.showRepeatedHint=!0)},a.confirmSubmit=function(){a.submitting=!0,a.iconForm.applications=JSON.stringify(c.getApplications(a.addedApp)),d.addIcon(a.iconForm,function(){e(),a.submitting=!1},function(){a.submitting=!1})},a.deleteApp=function(b){a.addedApp=a.addedApp.filter(function(a){return a.APPID!==b.APPID}),a.$broadcast("addedAppChanged")},a.sortAddedApp=function(b){a.addedApp=c.sortAddedApp(b,a.addedApp)},a.addApp=function(b){var d;return c.isAdded(b,a.addedApp)?{success:!1,msg:"此app已经添加过"}:(d=a.addedApp.length,a.addedApp.push(b),a.$broadcast("addedAppChanging",b),c.getAppDetail(c.getAppId(b),"iconapp",function(b){a.addedApp[d]=b,a.$broadcast("addedAppChanged",b)}),{success:!0,msg:""})},a.getAddedApp=function(){return a.addedApp}}])}),define("boutique/icon-add/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("iconAddService",["httpService",function(a){return{addIcon:function(b,d,e){a.post({r:"boutiqueIconApp/create",data:b,success:function(a){c.publish("businessSuccess",{title:"编辑iconapp成功!",msg:""}),d&&d(a)},error:e})},getIconDetail:function(b,c,d){var e={id:b,type:"iconapp"};a.get({r:"boutique/edit",data:e,success:function(a){a.applications=JSON.parse(a.applications),c(a)},error:d})}}}])}),define("boutique/picture-add/controller",["app","public/local/system","public/local/service","./service","public/local/http","public/general/pub-sub","./directive","public/general/directive/drag-sort","public/general/directive/submitting"],function(a){var b=a("app"),c=a("public/local/system");a("public/local/service"),a("./service"),a("./directive"),a("public/general/directive/drag-sort"),a("public/general/directive/submitting"),b.controller("pictureAddCtrl",["$scope","$routeParams","publicService","pictureAddService",function(a,b,d,e){function f(){a.pictureForm={id:"",release_time:"",applications:""},a.hasNullPicApp=!1,a.submitted=!1,a.addedApp=[]}a.needAppCount=4,a.introduceTemplateUrl=c.getTplAbsolutePath("tpl/public/app-introduce-edit.html"),a.repeatedApp=[],a.showRepeatedHint=!1,a.hasNullPicApp=!1,f(),"null"!=b.id&&e.getPictureDetail(b.id,function(c){a.pictureForm.id=b.id,a.pictureForm.release_time=c.release_time,c.applications.forEach(function(b){a.addApp(b)})}),a.addPicture=function(b){a.submitted=!0,b&&a.addedApp.length>=1&&!a.hasNullPicApp&&!a.submitting&&(a.repeatedApp=d.getRepeatedApp(a.addedApp,a.pictureForm.release_time,"IpadBoutiquePicApp"),0===a.repeatedApp.length?a.confirmSubmit():a.showRepeatedHint=!0)},a.confirmSubmit=function(){a.submitting=!0;var b=d.getApplications(a.addedApp);b.forEach(function(b){a.addedApp.some(function(a){return d.getAppId(b)===d.getAppId(a)?(b.index_pic=a.indexPic,!0):!1})}),a.pictureForm.applications=JSON.stringify(b),e.addPicture(a.pictureForm,function(){f(),a.submitting=!1},function(){a.submitting=!1})},a.updateHasNullPicApp=function(){a.hasNullPicApp=a.addedApp.some(function(a){return 0===a.preview.length})},a.deleteApp=function(b){a.addedApp=a.addedApp.filter(function(a){return a.APPID!==b.APPID}),a.$broadcast("addedAppChanged"),a.updateHasNullPicApp()},a.sortAddedApp=function(b){a.addedApp=angular.copy(d.sortAddedApp(b,a.addedApp))},a.addApp=function(b){var c;return d.isAdded(b,a.addedApp)?{success:!1,msg:"此app已经添加过"}:(c=a.addedApp.length,a.addedApp.push(b),a.$broadcast("addedAppChanging",b),d.getAppDetail(d.getAppId(b),"picapp",function(d){a.addedApp[c]=d,a.addedApp[c].introduce=b.summary||d.APPINTRO,a.addedApp[c].indexPic=b.index_pic||a.addedApp[c].indexPic,a.$broadcast("addedAppChanged",d),a.updateHasNullPicApp()}),{success:!0,msg:""})},a.getAddedApp=function(){return a.addedApp},a.updateIntroduce=function(a,b){var c=b.app;b.introduceSubmitted=!0,a&&(c.introduce=c.tempIntroduce,b.deletePopover=!0,b.introduceSubmitted=!1)}}])}),define("boutique/picture-add/directive",["app"],function(a){var b=a("app");b.directive("produceLine",[function(){return{restrict:"A",link:function(a,b){var c=$(b).parents("tr"),d=$("<tr></tr>");d.append($(b)),c.after(d),d.find("td").attr("colspan","11")}}}]),b.directive("deleteContent",[function(){return{restrict:"A",link:function(a,b){var c=new MutationObserver(function(){$(b).find("[data-remove]").remove()}),d={subtree:!0,childList:!0,attributeFilter:["data-remove"]};c.observe($(b)[0],d)}}}])}),define("boutique/picture-add/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("pictureAddService",["httpService",function(a){return{addPicture:function(b,d,e){a.post({r:"boutiquePicApp/create",data:b,success:function(a){c.publish("businessSuccess",{title:"编辑图形app成功!",msg:""}),d&&d(a)},error:e})},getPictureDetail:function(b,c,d){var e={id:b,type:"picapp"};a.get({r:"boutique/edit",data:e,success:function(a){a.applications=JSON.parse(a.applications),c(a)},error:d})}}}])}),define("boutique/slide-add/controller",["app","public/local/system","public/local/app-search","public/local/article-search","./service","public/local/http","public/general/pub-sub","public/general/directive/preview-img","public/general/directive/set-file","public/general/directive/popover","public/general/directive/trigger-click","public/general/directive/file-required","public/general/directive/file-type","public/general/directive/img-size","public/local/service","public/general/directive/form-reset","public/general/directive/clear-img","public/general/directive/submitting","article/article-create/service","public/general/form-validation"],function(a){var b=a("app"),c=a("public/local/system");a("public/local/app-search"),a("public/local/article-search"),a("./service"),a("public/general/directive/preview-img"),a("public/general/directive/set-file"),a("public/general/directive/popover"),a("public/general/directive/trigger-click"),a("public/general/directive/file-required"),a("public/general/directive/file-type"),a("public/general/directive/img-size"),a("public/local/service"),a("public/general/directive/form-reset"),a("public/general/directive/clear-img"),a("public/general/directive/submitting"),a("article/article-create/service");var d=a("public/general/form-validation");b.controller("slideAddCtrl",["$scope","$routeParams","slideAddService","articleCreateService","publicService",function(a,e,f,g,h){function i(){a.slide={imgUrl:"",set slidePicFiles(b){a.slideForm.up_file=b[0],a.$digest()}},a.formReset=!0,a.imgClear=!0,a.slideForm={id:"",release_time:"",link:"",title:"",up_file:"",applications:"",article_id:""},a.submitted=!1,a.addedApp=[],a.addedArticle=[]}var j=0,k=1;a.needAppCount=1,a.needArticleCount=1,a.introduceTemplateUrl=c.getTplAbsolutePath("tpl/public/app-introduce-edit.html"),a.repeatedApp=[],a.showRepeatedHint=!1,i(),e.id&&"null"!=e.id&&f.getSlideDetail(e.id,function(b){a.slideForm.id=e.id,a.slideForm.release_time=b.release_time,a.slideForm.link=b.link,a.slideForm.title=b.title,a.slide.imgUrl=b.up_file,a.slideForm.link==j?b.applications.forEach(function(b){a.addApp(b)}):a.slideForm.link==k&&g.getArticleDetail(b.article_id,function(b){a.addArticle(b)})}),a.addSlide=function(b){a.submitted=!0,d.setFormValidataion(b),b.$valid&&!a.submitting&&(a.addedApp.length>0||a.addedArticle.length>0)&&(a.slideForm.link==j?(a.repeatedApp=h.getRepeatedApp(a.addedApp,a.slideForm.release_time,"IpadBoutiqueTurnPic"),0===a.repeatedApp.length?a.confirmSubmit():a.showRepeatedHint=!0):a.confirmSubmit())},a.confirmSubmit=function(){a.submitting=!0,a.slideForm.link==j&&a.addedApp.length==a.needAppCount?(a.slideForm.applications=JSON.stringify(h.getApplications(a.addedApp)),f.addSlide(a.slideForm,function(){i(),a.submitting=!1},function(){a.submitting=!1})):a.slideForm.link==k&&a.addedArticle.length==a.needArticleCount&&(a.slideForm.article_id=a.addedArticle[0].id,f.addSlide(a.slideForm,function(){i(),a.submitting=!1},function(){a.submitting=!1}))},a.addApp=function(b){var c=h.getAppId(b);return a.$broadcast("addedAppChanging",b),h.getAppDetail(c,"turnpic",function(c){a.addedApp[0]=c,a.addedApp[0].introduce=b.summary||c.APPINTRO,a.$broadcast("addedAppChanged",c)}),{success:!0,msg:""}},a.addArticle=function(b){return a.addedArticle[0]=b,a.$broadcast("addedArticleChanged"),{msg:"",success:!0}},a.deleteApp=function(){a.addedApp=[],a.$broadcast("addedAppChanged",b)},a.deleteArticle=function(){a.addedArticle=[],a.$broadcast("addedArticleChanged")},a.getAddedApp=function(){return a.addedApp},a.getAddedArticle=function(){return a.addedArticle},a.updateIntroduce=function(a,b){var c=b.app;b.introduceSubmitted=!0,a&&(c.introduce=c.tempIntroduce,b.deletePopover=!0,b.introduceSubmitted=!1)},a.$on("formReseted",function(){a.slideForm.link=j})}])}),define("boutique/slide-add/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("slideAddService",["httpService",function(a){return{addSlide:function(b,d,e){a.post({r:"boutiqueTurnPic/create",data:b,success:function(a){c.publish("businessSuccess",{title:"编辑轮播图成功!",msg:""}),d&&d(a)},error:function(){e&&e(b)}})},getSlideDetail:function(b,c,d){var e={id:b,type:"turnpic"};a.get({r:"boutique/edit",data:e,success:function(a){a.applications=JSON.parse(a.applications),c(a)},error:d})}}}])}),define("index/controller",["app","./service","public/general/storage","public/local/http","./directive","public/general/pub-sub","public/general/directive/alert","public/local/system","public/local/share"],function(a){var b=a("app");a("./service"),a("./directive");var c=a("public/general/pub-sub");a("public/local/http"),a("public/general/directive/alert");var d=a("public/local/system");a("public/local/share"),b.controller("appInfoCtrl",["$window","$scope","shareDataService","systemInfoService","httpService",function(a,b,e,f){c.subscribe("serverError",function(a){b.alertShow=!0,b.alertType="alert-danger",b.alertContent="服务器出错啦！状态码:"+a.status+"请求接口:"+a.url}),c.subscribe("jsonError",function(a){b.alertShow=!0,b.alertType="alert-danger",b.alertContent="服务器返回数据格式不正确！返回数据："+a.response+",请求接口："+a.url}),c.subscribe("businessError",function(a){b.alertShow=!0,b.alertType="alert-danger",b.alertContent=a.title+a.msg}),c.subscribe("businessSuccess",function(a){b.alertShow=!0,b.alertType="alert-success",b.alertContent=a.title+a.msg}),b.name="快用iPad版管理系统",b.version="2.0",b.systems=[{name:"快用PC端管理系统",action:"http://pc.kuaiyong.com/"}],f.getUserPermission().done(function(a){b.modules=a.children,b.pages=b.modules[0].children}),f.getUserInfo(function(a){b.user=a.name}),b.logout=function(){f.clearLocalUserPermission(),f.clearLocalUserInfo(),a.location.href=d.getRequestInterface("index/logout")},b.$on("$locationChangeStart",function(a,c){f.getModuleAndPage(c,function(a){a&&b.modules.forEach(function(c){c.id===a.module.id?(c.active="active",b.pages=c.children,c.children.forEach(function(b){b.active=b.id===a.page.id?"active":""})):c.active=""})})})}])}),define("index/directive",["app"],function(a){var b=a("app");b.directive("deleteDatePicker",[function(){return{restrict:"A",link:function(a){a.$on("$locationChangeStart",function(){$("body .datetimepicker").remove()})}}}])}),define("index/service",["app","public/general/storage","public/local/http"],function(a){var b=a("app"),c=a("public/general/storage");a("public/local/http"),b.service("systemInfoService",["httpService",function(a){var b,d="userInfo",e="userPermission";return{getUserInfo:function(b){c.has(d)?b(c.get(d)):a.get({r:"index/userinfo",success:function(a){var e={id:a.id,name:a.name,email:a.email,phone:a.phone};b(e),c.store(d,e)}})},getUserPermission:function(){return b||(b=$.Deferred(),c.has(e)?b.resolve(c.get(e)):a.get({r:"index/role",success:function(a){a.children=a.children||[],a.children.forEach(function(a){a.children=a.children||[],a.action=a.children[0]?a.children[0].action:""}),b.resolve(a),c.store(e,a)}})),b},clearLocalUserInfo:function(){c.remove(d)},clearLocalUserPermission:function(){c.remove(e)},getModuleAndPage:function(a,b){function c(a){return"null"==a.substring(a.length-4,a.length)?a.substring(0,a.length-4):a}var d=null;this.getUserPermission().done(function(e){e.children.some(function(b){var e=!1;return b.children.some(function(f){var g=!1;return-1!=a.indexOf(c(f.action))&&(g=!0,e=!0,d={page:f,module:b}),g}),e}),b(d)})}}}])}),define("main",["app","route"],function(a){{var b=a("app");a("route")}angular.bootstrap(document,[b.name])}),define("public/general/app-cache",[],function(){}),define("public/general/date-util",[],function(){return{parse:function(a){return a=a.replace(/-/g,"/"),new Date(a)}}}),define("public/general/directive/alert",["app","public/local/system"],function(a){var b=a("app"),c=a("public/local/system");b.directive("alert",["$timeout",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{show:"=",showType:"=",noAutoHide:"="},templateUrl:c.getTplAbsolutePath("tpl/directive/alert.html"),link:function(b,c,d){var e=($(c),parseInt(d.showTime||0));b.hideAlert=function(){b.show=!1},b.$watch("show",function(){b.show&&!b.noAutoHide&&a(function(){b.show=!1},e||5e3)})}}}])}),define("public/general/directive/clear-img",["app"],function(a){var b=a("app");b.directive("clearImg",function(){return{restrict:"A",scope:{clear:"="},link:function(a,b){a.$watch("clear",function(){a.clear&&($(b)[0].src="",a.clear=!1)})}}})}),define("public/general/directive/confirm-hint",["app"],function(a){var b=a("app"),c=$("#modal-hint");c.modal({keyboard:!1,show:!1,backdrop:!1}),b.directive("confirmHint",function(){return{restrict:"A",link:function(a,b,d){var e=$(b),f=!1;document.addEventListener("click",function(a){e[0]===a.target&&(f?f=!1:(a.stopPropagation(),c.find(".modal-title").html(d.modalTitle),c.find(".modal-body").html(d.modalContent),c.modal("show"),c.find(".confirm")[0].onclick=function(){f=!0,c.modal("hide"),a.target.click()}))},!0)}}})}),define("public/general/directive/date-picker",["app","public/local/system","public/general/util"],function(a){var b=a("app"),c=a("public/local/system"),d=a("public/general/util");b.directive("datePicker",function(){return{restrict:"E",replace:"true",scope:!0,templateUrl:c.getTplAbsolutePath("tpl/directive/date-picker.html"),compile:function(a,b){var c=$(a),e={};for(var f in b)b.hasOwnProperty(f)&&(f.match(/^ng/)||"required"===f||"name"===f||"placeholder"===f)&&(e[b.$attr[f]]=b[f]);return c.find("input").attr(e),function(a,b,c){$(b).attr("data-date",(new Date).toJSON().substring(0,10));var e=$(b).datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:c.startView||2,minView:c.minView||2,forceParse:0,showMeridian:1});$(".datetimepicker").find(".next").html('<i class="glyphicon glyphicon-arrow-right"></i>'),$(".datetimepicker").find(".prev").html('<i class="glyphicon glyphicon-arrow-left"></i>'),e.on("changeDate",function(){a.$parent.$apply(function(){d.setPropertyValue(a.$parent,c.ngModel,$(b).find("input").val())})})}}}})}),define("public/general/directive/directive",[],function(){}),define("public/general/directive/drag-sort",["app"],function(a){var b=a("app");b.directive("dragId",function(){return{restrict:"A",link:function(a,b){$(b).attr("draggable","true")}}}),b.directive("dragSort",function(){return{restrict:"A",scope:{dragCompleted:"="},link:function(a,b,c){function d(a){var b;return f.find(h).each(function(d,e){e.getAttribute(c.dragSort)===a.getAttribute(c.dragSort)&&(b=d+1)}),b}var e,f=$(b),g=-1,h="["+c.dragSort+"]";f.delegate(h,"dragstart",function(a){var b=a.originalEvent;e=a.currentTarget,g=d(e),$(e).addClass("moving"),b.dataTransfer.setData("text",""),b.dataTransfer.effectAllowed="move"}),f.delegate(h,"dragover",function(a){var b;if(e){if(b=a.currentTarget,b===e)return;var c=2===e.compareDocumentPosition(b)?"before":"after";$(b)[c](e)}}),f.delegate(h,"dragend",function(){var b=[];$(e).removeClass("moving"),(g!==d(e)||"forceRefresh"in c)&&(f.children().attr("data-remove",""),f.find(h).each(function(a,d){b.push({id:d.getAttribute(c.dragSort),sort:a+1})}),a.$apply(function(){a.dragCompleted(b,c.dragParam,e.getAttribute(c.dragSort))})),e=null,g=-1})}}})}),define("public/general/directive/editor",["app","public/local/system","public/general/util","../jquery-plugin/editor","public/local/http"],function(a){function b(){var a=["Serif","Sans","Arial","Arial Black","Courier","Courier New","Comic Sans MS","Helvetica","Impact","Lucida Grande","Lucida Sans","Tahoma","Times","Times New Roman","Verdana"],b=$(".font-set").siblings(".dropdown-menu");$.each(a,function(a,c){b.append($('<li><a data-edit="fontName '+c+'" style="font-family:\''+c+"'\">"+c+"</a></li>"))}),$("a[title]").tooltip({container:"body"}),$(".dropdown-menu input").click(function(){return!1}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="",$(this).change()}),$("[data-role=magic-overlay]").each(function(){var a=$(this),b=$(a.data("target"));a.css("opacity",0).css("position","absolute").offset(b.offset()).width(b.outerWidth()).height(b.outerHeight())})}var c=a("app"),d=a("public/local/system"),e=a("public/general/util");a("../jquery-plugin/editor"),a("public/local/http"),c.directive("editor",["$compile","httpService",function(a,c){return{restrict:"E",replace:!0,scope:!0,templateUrl:d.getTplAbsolutePath("tpl/directive/editor.html"),compile:function(a,d){var f=$(a),g=function(a,d,g){var h=f.find("#editor");b(),h.wysiwyg(),h.on("fileSelected",function(a,b){var d=b[0];d&&/image/.test(d.type)&&c.post({r:"index/imageUpload",data:{up_file:b[0]},success:function(a){h.trigger("fileUploaded",[a.image_url])}})}),h.on("editorContentChanged",function(b,c){a.$parent.$apply(function(){f.find("textarea").html(c),e.setPropertyValue(a.$parent,g.ngModel,c)})}),a.$parent.$watch(g.ngModel,function(){var b=h.cleanHtml(),c=e.getPropertyValue(a.$parent,g.ngModel);c!==b&&h.html(c)})},h={};for(var i in d)d.hasOwnProperty(i)&&(i.match(/^ng/)||"required"===i||"name"===i)&&(h[d.$attr[i]]=d[i]);
return f.find("textarea").attr(h),g}}}])}),define("public/general/directive/file-required",["app","public/general/form-validation"],function(a){var b=a("app"),c=a("public/general/form-validation");b.directive("fileRequired",function(){return{restrict:"A",link:function(a,b){var d=$(b),e=angular.element(b).parent("form").scope(),f=d.parents("form").prop("name"),g=d.prop("name"),h=e[f][g],i=h.$error;i.required=!0,c.setFieldValidation(h),c.setFormValidataion(e[f]),d.bind("change",function(){var a=d[0].files[0];e.$apply(function(){e[f][g].$error.required=a?!1:!0,c.setFieldValidation(h),c.setFormValidataion(e[f])})})}}})}),define("public/general/directive/file-type",["app","public/general/form-validation"],function(a){var b=a("app"),c=a("public/general/form-validation");b.directive("fileType",function(){return{restrict:"A",link:function(a,b,d){var e=$(b),f=angular.element(b).parent("form").scope(),g=e.parents("form").prop("name"),h=e.prop("name"),i=f[g][h],j=i.$error;e.bind("change",function(){var a=e[0].files[0];f.$apply(function(){j.fileType=a&&-1===a.type.indexOf(d.fileType)?!0:!1,c.setFieldValidation(i),c.setFormValidataion(f[g])})})}}})}),define("public/general/directive/form-reset",["app"],function(a){var b=a("app");b.directive("formReset",function(){return{restrict:"A",scope:{reset:"="},link:function(a,b){a.$watch("reset",function(){a.reset&&($(b)[0].reset(),a.reset=!1,a.$emit("formReseted"))})}}})}),define("public/general/directive/img-size",["app","public/general/form-validation"],function(a){var b=a("app"),c=a("public/general/form-validation");b.directive("imgSize",function(){return{restrict:"A",link:function(a,b,d){{var e=$(b),f=angular.element(b).parent("form").scope(),g=e.parents("form").prop("name"),h=e.prop("name"),i=f[g][h];i.$error}e.bind("change",function(){function a(){var a=b+"*"+j;f.$apply(function(){f[g][h].$error.imgSize=a!==d.imgSize.trim()?!0:!1,c.setFieldValidation(i),c.setFormValidataion(f[g])})}var b,j,k=e[0].files[0];if(k&&-1!=k.type.indexOf("image")){var l=new Image,m=new FileReader;l.onload=function(){b=l.naturalWidth,j=l.naturalHeight,a()},m.addEventListener("load",function(a){l.src=a.target.result}),m.readAsDataURL(k)}else f.$apply(function(){f[g][h].$error.imgSize=!1,c.setFieldValidation(i),c.setFormValidataion(f[g])})})}}})}),define("public/general/directive/pagination",["app","public/local/system","public/local/http"],function(a){var b=a("app"),c=a("public/local/system");a("public/local/http"),b.directive("pagination",["httpService",function(a){return{restrict:"E",replace:!0,templateUrl:c.getTplAbsolutePath("tpl/directive/pagination.html"),scope:{paginationScope:"="},link:function(b,c){function d(a){b.searchResult=a,b.searchResult.pageCount=parseInt((parseInt(a.count)+a.pageSize-1)/a.pageSize),b.searchResult.pageInfo=e(b.searchResult.pageCount,a.page),angular.forEach(a,function(a){angular.isArray(a)&&a.forEach(function(a,c){a.order=b.searchResult.pageSize*b.searchResult.page-b.searchResult.pageSize+1+c})})}function e(a,b){var c=b-5;1>c&&(c=1);for(var d=[],e=0;10>e&&a>=c+e;++e)d.push(c+e);return{pageRange:d,last:1==b?!1:b-1,next:b==a?!1:b+1}}$(c);b.paginationScope=b,b.goPage=function(c){c!==!1&&(void 0===c?b.searchForm.page=b.searchForm.page||1:c&&(b.searchForm.page=c),b.$emit("searchStart"),a.get({r:b.searchInterface,data:b.searchForm,success:function(a){d(a),b.$emit("searchEnd",a)},error:function(a){b.$emit("searchFail",a)}}))},b.autoSearch&&(b.goPage=1)}}}])}),define("public/general/directive/popover",["app"],function(a){function b(){return d++}var c=a("app"),d=0;c.directive("popover",["$compile",function(a){return{restrict:"A",scope:{close:"="},link:function(c,d,e){var f="popover-"+b(),g=$(d),h=e.style||"",i=$(e.selector).html();g.popover({html:!0,content:"<div id='"+f+"'style='"+h+"'></div>"}),g.on("shown.bs.popover",function(){$("#"+f).append(a(i)(c.$parent))}),c.$watch("close",function(){c.close&&(g.popover("hide"),c.close=!1)})}}}])}),define("public/general/directive/prevent-spread",["app"],function(a){var b=a("app");b.directive("preventSpread",function(){return{restrict:"A",link:function(a,b,c){var d=$(b);d.bind(c.preventSpread,function(a){a.stopPropagation()})}}})}),define("public/general/directive/preview-img",["app","public/local/system"],function(a){{var b=a("app");a("public/local/system")}b.directive("previewImg",function(){return{restrict:"A",link:function(a,b,c){var d=$(b),e=$(c.previewImg);d.bind("change",function(){var a=d.prop("files")[0];if(a&&-1!==a.type.indexOf("image")){var b=new FileReader;b.addEventListener("load",function(a){e.prop("src",a.target.result)}),b.readAsDataURL(a)}else e.prop("src","")})}}})}),define("public/general/directive/set-file",["app","public/general/util","public/local/system"],function(a){{var b=a("app"),c=a("public/general/util");a("public/local/system")}b.directive("setFile",function(){return{restrict:"A",link:function(a,b,d){var e=$(b);e.bind("change",function(){c.setPropertyValue(a,d.setFile,e[0].files)})}}})}),define("public/general/directive/submitting",["app"],function(a){var b=a("app");b.directive("submitting",function(){return{restrict:"A",scope:{isSubmitting:"="},link:function(a,b,c){var d,e=$(b),f=c.submitting||"提交中...",g=e.val()||e.html();"BUTTON"===e[0].nodeName?d="html":"INPUT"===e[0].nodeName&&(d="val"),a.$watch("isSubmitting",function(){a.isSubmitting?(e[d](f),e.attr("disabled","disabled")):(e[d](g),e.removeAttr("disabled"))})}}})}),define("public/general/directive/tooltip",["app"],function(a){var b=a("app");b.directive("tooltip",function(){return{restrict:"A",link:function(a,b,c){var d=$(b),e=c.tooltip||30,f=new MutationObserver(function(){var a=d.html().trim();a.replace(/\.\.\.$/,"").length>e&&d.html(a.substring(0,e)+"...")});f.observe(d[0].childNodes[0],{characterData:!0}),d.tooltip({delay:{show:0,hide:0}})}}})}),define("public/general/directive/trigger-click",["app"],function(a){var b=a("app");b.directive("triggerClick",function(){return{restrict:"A",link:function(a,b,c){var d=$(b);d.bind("click",function(){$(c.triggerClick).click()})}}})}),define("public/general/directive/view-img",["app"],function(a){var b=a("app"),c=$("#modal-view-img");c.modal({show:!1}),b.directive("viewImg",function(){return{restrict:"A",link:function(a,b,d){var e=$(b);e.bind("click",function(){e.attr("src")&&(c.find(".modal-title").html(d.imgTitle),c.find(".modal-body img").attr("src",e.attr("src")),c.modal("show"))})}}})}),define("public/general/form-validation",[],function(){return{setFieldValidation:function(a){a.$valid=!0,a.$invalid=!1;for(var b in a.$error)a.$error.hasOwnProperty(b)&&a.$error[b]&&(a.$valid=!1,a.$invalid=!0)},setFormValidataion:function(a){a.$valid=!0,a.$invalid=!1;for(var b in a)a.hasOwnProperty(b)&&"$"!==b.substring(0,1)&&a[b].$invalid&&(a.$valid=!1,a.$invalid=!0)}}}),define("public/general/jquery-plugin/editor",[],function(){!function(a){function b(a){return a=a.trim(),a&&(a=a.replace(/<div/g,"<p").replace(/<\/div>/g,"</p>"),a=a.replace(/<(\/)?br>/g,""),a=a.replace(/\u200b/g,""),a=a.replace(/<p>\s*<\/p>/g,""),a=a.replace(/class=['"]info-center['"]/g,""),a=a.replace(/<p((.(?!<p|class=|<\/p))*)(?=<img|<iframe)/g,"<p class='info-center' $1"),a&&!/^<p/.test(a)&&(a=a.replace(/<p/,"</p><p"),a="<p>"+a,/<\/p>/.test(a)||(a+="</p>")),a=a.replace(/(<iframe[^>]*src=['"])http:\/\/player.youku.com\/embed\/(.+)(['"][^>]*>)/g,"$1http://pic.wanmeiyueyu.com/upload/youkukilledrelate.html#$2$3")),a}a.fn.cleanHtml=function(){return b(a(this).hasClass("source-mode")?a(this).text():a(this).html())},a.fn.wysiwyg=function(c){var d,e,f,g=this,h=function(){e.activeToolbarClass&&a(e.toolbarSelector).find(f).each(function(){var b=a(this).data(e.commandRole);document.queryCommandState(b)?a(this).addClass(e.activeToolbarClass):a(this).removeClass(e.activeToolbarClass)})},i=function(a,b){var c=a.split(" "),d=c.shift(),e=c.join(" ")+(b||""),f=document.execCommand(d,0,e);return h(),f},j=function(b){a.each(b,function(a,b){g.keydown(a,function(a){g.attr("contenteditable")&&g.is(":visible")&&(a.preventDefault(),a.stopPropagation(),i(b))}).keyup(a,function(a){g.attr("contenteditable")&&g.is(":visible")&&(a.preventDefault(),a.stopPropagation())})})},k=function(){var a=window.getSelection();return a.getRangeAt&&a.rangeCount?a.getRangeAt(0):void 0},l=function(){d=k()},m=function(){var a=window.getSelection();if(d){try{a.removeAllRanges()}catch(b){document.body.createTextRange().select(),document.selection.empty()}a.addRange(d)}},n=function(a){g.focus(),i("inserthtml","<p><img src='"+a+"' /></p>")},o=function(a,b){m(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",0,b||"transparent"),l(),a.data(e.selectionMarker,b)},p=function(c,d){function e(){""===g.html().replace(/\s+/g,"")&&i("insertHtml","<p>&#8203;</p>")}c.find(f).click(function(){m(),g.focus(),i(a(this).data(d.commandRole)),l()}),c.find("[data-toggle=dropdown]").click(m),c.find("input[type=text][data-"+d.commandRole+"]").on("webkitspeechchange change",function(){var b=this.value;this.value="",m(),b&&(g.focus(),i(a(this).data(d.commandRole),b)),l()}).on("focus",function(){var b=a(this);b.data(d.selectionMarker)||(o(b,d.selectionColor),b.focus())}).on("blur",function(){var b=a(this);b.data(d.selectionMarker)&&o(b,!1)}),c.find("input[type=file][data-"+d.commandRole+"]").change(function(){m(),"file"===this.type&&this.files&&this.files.length>0&&g.trigger("fileSelected",[this.files]),l(),this.value=""}),g.on("fileUploaded",function(a,b){n(b)}),c.find("[data-operation='full-screen']").on("click",function(){a("#editor-zone").toggleClass("full-screen"),a("body").css(a("#editor-zone").hasClass("full-screen")?{overflow:"hidden"}:{overflow:""})}),c.find("[data-operation=source-mode]").on("click",function(){g.toggleClass("source-mode");var d,e=/</g,h=/>/g;g.hasClass("source-mode")?(a(this).attr("data-original-title","源码模式"),c.find(f).addClass("disabled"),c.find("[data-toggle],#pictureBtn").addClass("disabled"),c.find("[type=file]").attr("disabled",""),d=b(g.html()),d=d.replace(/&/g,"&amp;"),d=d.replace(/(<p[^>]*>)/g,"$1&nbsp;&nbsp;"),d=d.replace(e,"<br/>&lt;").replace(h,"&gt;<br/>"),g.focus(),g.html(""),i("insertHtml",d)):(a(this).attr("data-original-title","编辑模式"),c.find(f).removeClass("disabled"),c.find("[data-toggle],#pictureBtn,[type=file]").removeClass("disabled"),c.find("[type=file]").removeAttr("disabled"),d=g.text(),d=d.replace(/[\u00a0\u0020\u0009]+/g," "),d=d.replace(/>[\u00a0\u0020\u0009]{1,2}/g,">"),g.focus(),g.html(""),i("insertHtml",d))}),function(){var a=new MutationObserver(function(){e(),g.trigger("editorContentChanged",[g.cleanHtml()])}),b={subtree:!0,characterData:!0,childList:!0,attributes:!0};a.observe(g[0],b)}(),g.bind("keypress",function(){e()})},q=function(){g.on("dragenter dragover",!1).on("drop",function(a){var b=a.originalEvent.dataTransfer;a.stopPropagation(),a.preventDefault(),b&&b.files&&b.files.length>0&&n(b.files)})};return e=a.extend({},a.fn.wysiwyg.defaults,c),f="a[data-"+e.commandRole+"],button[data-"+e.commandRole+"],input[type=button][data-"+e.commandRole+"]",j(e.hotKeys),e.dragAndDropImages&&q(),p(a(e.toolbarSelector),e),g.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){l(),h()}),a(window).bind("touchend",function(a){var b=g.is(a.target)||g.has(a.target).length>0,c=k(),d=c&&c.startContainer===c.endContainer&&c.startOffset===c.endOffset;(!d||b)&&(l(),h())}),this},a.fn.wysiwyg.defaults={hotKeys:{"ctrl+b meta+b":"bold","ctrl+i meta+i":"italic","ctrl+u meta+u":"underline","ctrl+z meta+z":"undo","ctrl+y meta+y meta+shift+z":"redo","ctrl+l meta+l":"justifyleft","ctrl+r meta+r":"justifyright","ctrl+e meta+e":"justifycenter","ctrl+j meta+j":"justifyfull","shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgrey",dragAndDropImages:!0,fileUploadError:function(a,b){console.log("File upload error",a,b)}}}(window.jQuery)}),define("public/general/pub-sub",[],function(){var a={},b={};return{publish:function(c,d){a[c]=d,b[c]=b[c]||[],b[c].forEach(function(a){a(d)})},subscribe:function(a,c){b[a]=b[a]||[],b[a].push(c)},unSubscribe:function(a,c){b[a]=b[a]||[],b[a]=b[a].filter(function(a){return a!==c})}}}),define("public/general/storage",[],function(){return{store:function(a,b){var c=JSON.stringify(b);sessionStorage.setItem(a,c)},remove:function(a){sessionStorage.removeItem(a)},has:function(a){return!!sessionStorage.getItem(a)},get:function(a){var b=sessionStorage.getItem(a);return JSON.parse(b)}}}),define("public/general/util",[],function(){return{serialize:function(a){var b="",c="";a=a||{};for(var d in a)a.hasOwnProperty(d)&&(b?c="&":b="",b+=c+d+"="+a[d]);return b},getUrl:function(a,b){var c=this.serialize(b);return c&&(-1===a.indexOf("?")&&(a+="?"),"?"!=a.charAt(a.length-1)&&(a+="&"),a+=c),a},clone:function(a){return JSON.parse(JSON.stringify(a))},setPropertyValue:function(a,b,c){var d,e=b.split(".");e.forEach(function(b,c){c<e.length-1&&(a=a[b])}),d=e.pop(),a[d]=c},getPropertyValue:function(a,b){var c,d=b.split(".");return d.forEach(function(b,c){c<d.length-1&&(a=a[b])}),c=d.pop(),a[c]}}}),define("public/local/app-search",["app","public/local/system","public/general/util","public/local/http","public/general/directive/alert","public/general/directive/pagination"],function(a){var b=a("app"),c=a("public/local/system"),d=a("public/general/util");a("public/local/http"),a("public/general/directive/alert"),a("public/general/directive/pagination"),b.directive("appSearch",["httpService","$compile","$timeout",function(){return{restrict:"E",replace:!0,transclude:!0,scope:!0,templateUrl:c.getTplAbsolutePath("tpl/directive/app-search.html"),link:function(a,b){function c(){a.searchResult.apps.forEach(function(a){a.status=e(a)?"success":""})}function e(b){return a.getAddedApp().some(function(a){return b.APPID===a.APPID?!0:!1})}$(b);a.alertShow=!1,a.alertType="alert-danger",a.disabled=!1,a.search={method:"APPNAME",keywords:"",status:"1"},a.filter={range:"s_newapp",date_limit:0,neworupd:0,page_size:50,status:1,app_tag:0,sign:""},a.searchResult={apps:[]},a.searchStatus=a.SEARCH_STATUS.INIT,a.$on("searchStart",function(){a.searchStatus=a.SEARCH_STATUS.SEARCHING}),a.$on("searchEnd",function(b,d){a.searchStatus=a.SEARCH_STATUS.SEARCH_SUCCESSED,a.searchResult.apps=d.apps,c()}),a.$on("searchFail",function(){a.searchStatus=a.SEARCH_STATUS.SEARCH_FAILED}),a.searchApp=function(){a.paginationScope.searchForm=a.search,a.paginationScope.searchInterface="searchApp/search",a.paginationScope.goPage(1),a.setPanelOpen()},a.filterApp=function(){a.paginationScope.searchForm=a.filter,a.paginationScope.searchInterface="searchApp/filter",a.paginationScope.goPage(1),a.setPanelOpen()},a.selectApp=function(b){var c;a.disabled?(a.alertContent="获取详情中,不要急",a.alertShow=!0):(c=a.addApp(d.clone(b)),c.success||(a.alertContent="添加失败："+c.msg,a.alertShow=!0))},a.setPanelOpen=function(){a.hide=""},a.setPanelClose=function(){a.hide="hide"},a.$watch("hide",function(){"hide"===a.hide?(a.open="btn-default",a.close="btn-success"):(a.open="btn-success",a.close="btn-default")}),a.setPanelClose(),a.$on("addedAppChanging",function(){a.disabled=!0}),a.$on("addedAppChanged",function(){a.disabled=!1,c()})}}}])}),define("public/local/article-search",["app","public/local/system","public/general/util","public/local/http","public/general/directive/alert","public/general/directive/tooltip","public/general/directive/pagination"],function(a){{var b=a("app"),c=a("public/local/system");a("public/general/util")}a("public/local/http"),a("public/general/directive/alert"),a("public/general/directive/tooltip"),a("public/general/directive/pagination"),b.directive("articleSearch",["httpService","$compile","$timeout",function(){return{restrict:"E",replace:!0,transclude:!0,scope:!0,templateUrl:c.getTplAbsolutePath("tpl/directive/article-search.html"),link:function(a,b){function c(){a.searchResult.articleList.forEach(function(a){a.status=d(a)?"success":""})}function d(b){return a.getAddedArticle().some(function(a){return b.id===a.id?!0:!1})}$(b);a.disabled=!1,a.searchForm={title:""},a.searchResult={articleList:[]},a.searchStatus=a.SEARCH_STATUS.INIT,a.$on("searchStart",function(){a.searchStatus=a.SEARCH_STATUS.SEARCHING}),a.$on("searchEnd",function(b,d){a.searchStatus=a.SEARCH_STATUS.SEARCH_SUCCESSED,a.searchResult.articleList=d.data,c()}),a.$on("searchFail",function(){a.searchStatus=a.SEARCH_STATUS.SEARCH_FAILED}),a.search=function(){a.paginationScope.searchForm=a.searchForm,a.paginationScope.searchInterface="article/index",a.paginationScope.goPage(1)},a.selectArticle=function(b){a.addArticle(b)},a.$on("addedArticleChanged",function(){c()})}}}])}),define("public/local/http",["app","public/general/util","./system","public/general/pub-sub"],function(a){var b=a("app"),c=a("public/general/util"),d=a("./system"),e=a("public/general/pub-sub");b.service("httpService",["$http","$rootScope",function(a,b){return{get:function(b){a({method:"GET",url:c.getUrl(d.getRequestInterface(b.r),b.data)}).success(function(a,c,d,f){angular.isObject(a)?1==a.code?b.success&&b.success(a.data,d()):(e.publish("businessError",{title:"操作失败：",msg:a.msg}),b.error&&b.error(a)):(e.publish("jsonError",{status:c,response:a,url:f.url}),b.error&&b.error(a))}).error(function(a,c,d,f){b.error&&b.error(a),e.publish("serverError",{status:c,response:a,url:f.url})})},post:function(a){var c=new XMLHttpRequest,f=new FormData;for(var g in a.data)f.append(g,a.data[g]);c.open("POST",d.getRequestInterface(a.r)),c.onreadystatechange=function(){var f=null;4===c.readyState&&b.$apply(function(){if(c.status>=200&&c.status<300||304==c.status){try{f=JSON.parse(c.responseText)}catch(b){e.publish("jsonError",{response:c.responseText,url:d.getRequestInterface(a.r)}),a.error&&a.error(f)}1==f.code?a.success&&a.success(f.data):(a.error&&a.error(f),e.publish("businessError",{title:"操作失败：",msg:f.msg}))}else a.error&&a.error(c.responseText),e.publish("serverError",{status:c.status,response:c.responseText,url:d.getRequestInterface(a.r)})})},c.send(f)},getTpl:function(b){a({method:"GET",url:d.getTplAbsolutePath(b)}).success(function(a){config.success(a.data)}).error(function(){config.error()})}}}])}),define("public/local/service",["app","public/general/date-util","public/local/http"],function(a){{var b=a("app");a("public/general/date-util")}a("public/local/http"),b.service("publicService",["httpService",function(a){return{getAppDetail:function(b,c,d){a.get({r:"searchApp/appDetail",data:{appid:b,type:c},success:function(a){d(a)}})},getRepeatedApp:function(a,b,c){var d=[],e=864e6;return a.forEach(function(a){var f=[];a=angular.copy(a),a.repeat.forEach(function(a){var d=Date.parse(b)-Date.parse(a.release_time);d>0&&e>d&&a.type===c&&f.push(a)}),a.repeat=f,a.repeat.length>0&&d.push(a)}),d},getAppId:function(a){return a.APPID||a.app_id||a.appId},isAdded:function(a,b){var c=this;return b.some(function(b){return c.getAppId(a)===c.getAppId(b)})},sortAddedApp:function(a,b){var c=[],d=this;return a.forEach(function(a){c.push(d.getApp(a.id,b))}),c},sortAddedArticle:function(a,b){var c=[],d=this;return a.forEach(function(a){c.push(d.getArticle(a.id,b))}),c},getArticles:function(a){var b=[];return a.forEach(function(a){b.push({article_id:a.id})}),b},getApplications:function(a){var b=[];return a.forEach(function(a){b.push({app_id:a.APPID,summary:a.introduce,app_sign:a.APPDOWNLOADUSER})}),b},getApp:function(a,b){var c,d=this;return b.some(function(b){return a===d.getAppId(b)?(c=b,!0):void 0}),c},contains:function(a,b){return b=b||[],b.some(function(b){return b.id===a.id})},getArticle:function(a,b){var c;return b.some(function(b){return a===b.id?(c=b,!0):void 0}),c},isTop:function(a){var b=!1;return a.priority_etime&&a.priority_stime&&(b=!0),b}}}])}),define("public/local/share",["app"],function(a){var b=a("app");b.service("shareDataService",["$rootScope",function(a){a.SEARCH_STATUS={INIT:0,SEARCHING:1,SEARCH_SUCCESSED:2,SEARCH_FAILED:3}}])}),define("public/local/system",[],function(){var a="http://ipadbms.kuaiyong.com/protected/views/template/";return{getTplAbsolutePath:function(b){return a+b},getRequestInterface:function(a){return"http://ipadbms.kuaiyong.com/index.php?r="+a}}}),define("route",["app","public/local/system","index/controller","boutique/article-add/controller","boutique/icon-add/controller","boutique/picture-add/controller","boutique/slide-add/controller","boutique/boutique-list/controller","topic/topic-add/controller","topic/topic-list/controller","article/article-create/controller","article/article-list/controller"],function(a){var b=a("app"),c=a("public/local/system");a("index/controller"),a("boutique/article-add/controller"),a("boutique/icon-add/controller"),a("boutique/picture-add/controller"),a("boutique/slide-add/controller"),a("boutique/boutique-list/controller"),a("topic/topic-add/controller"),a("topic/topic-list/controller"),a("article/article-create/controller"),a("article/article-list/controller"),b.config(["$routeProvider",function(a){a.when("/boutique/boutique-list/",{controller:"boutiqueListCtrl",templateUrl:c.getTplAbsolutePath("tpl/boutique/boutique-list.html")}).when("/boutique/slide-add/:id",{controller:"slideAddCtrl",templateUrl:c.getTplAbsolutePath("tpl/boutique/slide-add.html")}).when("/boutique/picture-add/:id",{controller:"pictureAddCtrl",templateUrl:c.getTplAbsolutePath("tpl/boutique/picture-add.html")}).when("/boutique/icon-add/:id",{controller:"iconAddCtrl",templateUrl:c.getTplAbsolutePath("tpl/boutique/icon-add.html")}).when("/boutique/article-add/:id",{controller:"articleAddCtrl",templateUrl:c.getTplAbsolutePath("tpl/boutique/article-add.html")}).when("/topic/topic-list/",{controller:"topicListCtrl",templateUrl:c.getTplAbsolutePath("tpl/topic/topic-list.html")}).when("/topic/topic-add/:id",{controller:"topicAddCtrl",templateUrl:c.getTplAbsolutePath("tpl/topic/topic-add.html")}).when("/article/article-list/",{controller:"articleListCtrl",templateUrl:c.getTplAbsolutePath("tpl/article/article-list.html")}).when("/article/article-add/:id",{controller:"articleCreateCtrl",templateUrl:c.getTplAbsolutePath("tpl/article/article-create.html")}).otherwise({redirectTo:"/boutique/boutique-list"})}])}),define("topic/topic-add/controller",["app","public/local/app-search","./service","public/local/http","public/general/pub-sub","public/general/directive/preview-img","public/general/directive/set-file","public/general/directive/popover","public/general/directive/file-required","public/general/directive/file-type","public/general/directive/img-size","public/local/service","public/general/directive/submitting","public/general/form-validation","public/general/directive/form-reset"],function(a){var b=a("app");a("public/local/app-search"),a("./service"),a("public/general/directive/preview-img"),a("public/general/directive/set-file"),a("public/general/directive/popover"),a("public/general/directive/file-required"),a("public/general/directive/file-type"),a("public/general/directive/img-size"),a("public/local/service"),a("public/general/directive/submitting");var c=a("public/general/form-validation");a("public/general/directive/form-reset"),b.controller("topicAddCtrl",["$scope","$routeParams","topicAddService","publicService",function(a,b,d,e){function f(){a.topic={indexPicUrl:"",bannerUrl:"",backgroundUrl:"",set indexPicFiles(b){a.topicForm.index_pic=b[0],a.$digest()},set bannerFiles(b){a.topicForm.banner=b[0],a.$digest()},set backgroundFiles(b){a.topicForm.background=b[0],a.$digest()}},a.topicForm={id:"",title:"",introduce:"",index_pic:"",banner:"",background:"",applications:"",status:""},a.submitted=!1,a.addedApp=[],a.formReset=!0,a.imgClear=!0}function g(){var b=[];return a.addedApp.forEach(function(a){b.push({app_id:a.APPID,summary:a.introduce})}),b}f(),"null"!=b.id&&d.getTopicDetail(b.id,function(c){a.topicForm.id=b.id,a.topicForm.title=c.title,a.topicForm.introduce=c.introduce,a.topic.indexPicUrl=c.index_pic,a.topic.bannerUrl=c.banner,a.topic.backgroundUrl=c.background,c.applications.forEach(function(b){a.addApp(b)})}),a.addTopic=function(b){a.submitted=!0,c.setFormValidataion(b),b.$valid&&a.addedApp.length>0&&!a.publishing&&(a.publishing=!0,a.topicForm.applications=JSON.stringify(g()),d.addTopic(a.topicForm,function(){f(),a.publishing=!1},function(){a.publishing=!1}))},a.saveToDraft=function(b){a.submitted=!0,c.setFormValidataion(b),b.$valid&&a.addedApp.length>0&&!a.saving&&(a.saving=!0,a.topicForm.applications=JSON.stringify(g()),a.topicForm.status=3,d.addTopic(a.topicForm,function(){f(),a.saving=!1},function(){a.saving=!1}))},a.addApp=function(b){var c=a.addedApp.length;return e.isAdded(b,a.addedApp)?{success:!1,msg:"此app已经添加过"}:(a.addedApp.push(b),a.$broadcast("addedAppChanging",b),e.getAppDetail(e.getAppId(b),"",function(b){a.addedApp[c]=b,a.$broadcast("addedAppChanged",b)}),{success:!0,msg:""})},a.deleteApp=function(b){a.addedApp=a.addedApp.filter(function(a){return a.APPID!==b.APPID})},a.getAddedApp=function(){return a.addedApp}}])}),define("topic/topic-add/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("topicAddService",["httpService",function(a){return{addTopic:function(b,d,e){a.post({r:"special/create",data:b,success:function(a){c.publish("businessSuccess",{title:"编辑专题成功!",msg:""}),d&&d(a)},error:function(){e&&e(b)}})},getTopicDetail:function(b,c,d){var e={id:b};a.get({r:"special/edit",data:e,success:function(a){c(a)},error:d})}}}])}),define("topic/topic-list/controller",["./service","app","public/local/http","public/general/pub-sub"],function(a){a("./service");var b=a("app");b.controller("topicListCtrl",["$scope","$routeParams","publicService","topicListService",function(a,b,c,d){a.searchForm={status:"",title:""},a.searchResult={topicList:[]},a.$on("searchStart",function(){a.searchStatus=a.SEARCH_STATUS.SEARCHING}),a.$on("searchEnd",function(b,c){a.searchStatus=a.SEARCH_STATUS.SEARCH_SUCCESSED,a.searchResult.topicList=c.data}),a.$on("searchFail",function(){a.searchStatus=a.SEARCH_STATUS.SEARCH_FAILED}),a.search=function(){a.paginationScope.goPage(1)},a.deleteTopic=function(b){d.deleteTopic(b,function(){a.paginationScope.goPage()})},a.importTopic=function(){a.loading=!0,d.importTopic(null,function(){a.loading=!1},function(){a.loading=!1})},a.moveUp=function(b,c){d.moveUp(b,c,function(){a.paginationScope.goPage()})},a.moveDown=function(b,c){d.moveDown(b,c,function(){a.paginationScope.goPage()})},a.sortTopic=function(b,c,e){var f={};b.some(function(a){return a.id===e?(f.position=a.sort,f.id=a.id,!0):!1}),d.sortTopic(f,function(){a.paginationScope.goPage()})},a.pushToFrontEnd=function(b){d.pushToFrontEnd(b,function(){a.paginationScope.goPage()})},a.unlock=function(b){d.unlock(b,function(){a.paginationScope.goPage()})},a.lockPosition=function(b,c){var e=c.topic;c.lockPositionSubmitted=!0,b&&d.lock(e.id,e.lockPosition,function(){a.paginationScope.goPage(),c.deletePopover=!0,c.lockPositionSubmitted=!1})},a.$watch("paginationScope",function(){a.paginationScope&&(a.paginationScope.searchForm=a.searchForm,a.paginationScope.searchInterface="special/index",a.paginationScope.goPage(1))})}])}),define("topic/topic-list/service",["app","public/local/http","public/general/pub-sub"],function(a){var b=a("app");a("public/local/http");var c=a("public/general/pub-sub");b.service("topicListService",["httpService",function(a){return{getTopicList:function(b,c,d){a.get({r:"special/index",data:b,success:function(a){c(a)},error:d})},moveUp:function(a,b,c,d){this.move({id:a,position:b,direction:"up"},c,d)},moveDown:function(a,b,c,d){this.move({id:a,position:b,direction:"down"},c,d)},importTopic:function(b,d,e){a.get({r:"special/import",data:b,success:function(a){c.publish("businessSuccess",{title:"导入成功!",msg:""}),d&&d(a)},error:e})},move:function(b,d,e){a.get({r:"special/updatePosition",data:b,success:function(a){c.publish("businessSuccess",{title:"排序成功!",msg:""}),d&&d(a)},error:e})},lock:function(b,d,e,f){var g={id:b,position:d};a.get({r:"special/PositionLock",data:g,success:function(a){c.publish("businessSuccess",{title:"锁定成功!",msg:""}),e(a)},error:f})},sortTopic:function(b,d,e){a.get({r:"special/updatePosition",data:b,success:function(a){c.publish("businessSuccess",{title:"专题排序成功!",msg:""}),d(a)},error:e})},pushToFrontEnd:function(b,d,e){var f={id:b};a.get({r:"special/release",data:f,success:function(a){c.publish("businessSuccess",{title:"发布成功!",msg:""}),d(a)},error:e})},unlock:function(b,d,e){var f={id:b};a.get({r:"special/PositionUnlock",data:f,success:function(a){c.publish("businessSuccess",{title:"解锁成功!",msg:""}),d(a)},error:e})},deleteTopic:function(b,d,e){var f={id:b};a.get({r:"special/delete",data:f,success:function(a){c.publish("businessSuccess",{title:"删除专题成功!",msg:""}),d(a)},error:e})}}}])}),seajs.use("main");
//# sourceMappingURL=main.js.map